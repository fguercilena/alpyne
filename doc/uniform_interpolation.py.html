
<html>
    <head>
        <title> Uniform Interpolation </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">

        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6">
        </script>
        <script id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>

        <link rel="stylesheet" href="colorful.css" type="text/css">
    </head>

    <body>

        <h1> Uniform Interpolation </h1>

        <p class="intro">
            
Functions to handle interpolation of data defined on regular grids.  The
functions in this module implement a few methods to interpolate data
contained in numpy arrays. The data to interpolate can have 1, 2 or 3
dimensions, and it is constrained to be defined on an equally spaced grid.

Equally spaced means that on each axis the grid must be of the form
\(x_i = x_0 + i\Delta\). That is, the grid spacing delta between two adjacent
points must be a constant.

This means that, e.g. in one dimension the values y = [0, 1, 4, 9], the
result of applying the function \(f(x) = x^2\) to the points x = [0, 1, 2,
3] can be interpolated using the functions provided here, but data defined on
the grid x = [0, 1, 2.5, 6.8] cannot.

This restriction allows for much greater speed than e.g.
scipy.interpolate.interpn, because the location of the interpolation point on
the grid can be carried out in \(O(1)\) operations, instead of
\(O(\log(N))\) (binary search).

The implementation is sped-up using Numba. The implementation is also not
parallelized.

The functions collected here are optimized for speed and not safety:<br>
- they do not (generally) check for size mismatches in the
passed arguments<br>
- they are intended to work with 64 bit floating point data
("double precision"), but no check is performed on the argumets to ensure
they are of the correct type<br>
- extrapolation is not handled: if an interpolation points is outside the
region covered by the data (accounting also for any eventual ghost points
needed), the functions will crash or (worse) silently return nonsensical
results.

The module includes the following functions:<br>

<a href="#line-9">linterp1D</a>: linear interpolation in 1D<br>
<a href="#line-68">linterp2D</a>: linear interpolation in 2D<br>
<a href="#line-124">linterp3D</a>: linear interpolation in 3D<br>
These functions are second order accurate in the grid spacing and
require no ghosts. They cannot overshoot the data or generate spurious
extrema, but the interpolant is in general continuous but not differentiable.

<a href="#line-202">chinterp1D</a>: cubic Hermite interpolation in 1D<br>
<a href="#line-270">chinterp2D</a>: cubic Hermite interpolation in 2D<br>
<a href="#line-350">chinterp3D</a>: cubic Hermite interpolation in 3D<br>
These functions are third order accurate in the grid spacing and require 1
ghosts point on each axis. They can overshoot the data and/or generate
spurious extrema. The interpolant is guaranteed to be \(C^1\). The
derivatives of the data are implicitly estimated using second order accurate
three point stencils (making the interpolant 3rd order instead of 4th order
accurate, which would be the case if the derivatives were known exactly).

<a href="#line-565">spchinterp1D</a>: shape-preserving cubic Hermite
interpolation in 1D<br>
This function is generally third order accurate in the grid spacing, but has
typically larger errors than the Hermite functions above. It requires 1
ghosts point. The algorith however cannot overshoot the data or generate
spurious extrema. The interpolant is guaranteed to be \(C^1\).

        </p>

        <table style="width:100%">
            
<tr>
    <td style="vertical-align: top" class="explanation">
        
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-1"></a><span class="lineno">   1 </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn"><a href="uniform_interpolation.py.html#line-1">np</a></span><br><a name="line-2"></a><span class="lineno">   2 </span><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span><br><a name="line-3"></a><span class="lineno">   3 </span><br><a name="line-4"></a><span class="lineno">   4 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Linearly interpolate one-dimensional arrays at given points. The algorithm<br>implemented in this function is replicated exactly in the following linterp2D<br>and linterp3D functions, except in 2 and 3 dimensions respectively.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-8"></a><span class="lineno">   8 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-9"></a><span class="lineno">   9 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-9">linterp1D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-10"></a><span class="lineno">  10 </span>    <span class="sd">&quot;&quot;&quot;Linearly interpolate one-dimensional arrays at given points.</span><br><a name="line-11"></a><span class="lineno">  11 </span><br><a name="line-12"></a><span class="lineno">  12 </span><span class="sd">    Arguments:</span><br><a name="line-13"></a><span class="lineno">  13 </span><span class="sd">    p_x  -- 1D array:               interpolation points</span><br><a name="line-14"></a><span class="lineno">  14 </span><span class="sd">    o    -- scalar:                 first point of the grid</span><br><a name="line-15"></a><span class="lineno">  15 </span><span class="sd">    ih   -- scalar:                 inverse of the grid spacing</span><br><a name="line-16"></a><span class="lineno">  16 </span><span class="sd">    data -- array of shape (N, Nx): the data to be interpolated</span><br><a name="line-17"></a><span class="lineno">  17 </span><br><a name="line-18"></a><span class="lineno">  18 </span><span class="sd">    Returns:</span><br><a name="line-19"></a><span class="lineno">  19 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-20"></a><span class="lineno">  20 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-21"></a><span class="lineno">  21 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-22"></a><span class="lineno">  22 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Get the number of interpolation points, the number of input arrays, the<br>shape (in this case, the length) of the input arrays, and allocate the<br>result array.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-26"></a><span class="lineno">  26 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-27"></a><span class="lineno">  27 </span><br><a name="line-28"></a><span class="lineno">  28 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-29"></a><span class="lineno">  29 </span><br><a name="line-30"></a><span class="lineno">  30 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><br><a name="line-31"></a><span class="lineno">  31 </span><br><a name="line-32"></a><span class="lineno">  32 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-33"></a><span class="lineno">  33 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Loop over the interpolation points. Depending on the application, this<br>loop might be parallelized (if npoints is large enough, e.g. a few<br>hundred) to have better performance.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-37"></a><span class="lineno">  37 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-38"></a><span class="lineno">  38 </span><br><a name="line-39"></a><span class="lineno">  39 </span>        <span class="n">aux_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">)</span><span class="o">*</span><span class="n">ih</span><br><a name="line-40"></a><span class="lineno">  40 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Compute the index of the point in the array immediately preceding<br>the interpolation point
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-43"></a><span class="lineno">  43 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">aux_x</span><span class="p">)</span><br><a name="line-44"></a><span class="lineno">  44 </span><br><a name="line-45"></a><span class="lineno">  45 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-46"></a><span class="lineno">  46 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-47"></a><span class="lineno">  47 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Compute the interpolation coefficients. c_x0 is applied to the point<br>at index i, while c_x1 at the next point (at index i + 1)
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-50"></a><span class="lineno">  50 </span>        <span class="n">c_x1</span> <span class="o">=</span> <span class="n">aux_x</span> <span class="o">-</span> <span class="n">i</span><br><a name="line-51"></a><span class="lineno">  51 </span>        <span class="n">c_x0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c_x1</span><br><a name="line-52"></a><span class="lineno">  52 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Loop over the input arrays, and interpolate each of them using the<br>coefficients computed above. There is most likely no need to<br>parallelize this loop, because the bumber of input arrays is small<br>in most applications (typically a few tens at most).
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-57"></a><span class="lineno">  57 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-58"></a><span class="lineno">  58 </span><br><a name="line-59"></a><span class="lineno">  59 </span>            <span class="n">f_x0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><br><a name="line-60"></a><span class="lineno">  60 </span>            <span class="n">f_x1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-61"></a><span class="lineno">  61 </span><br><a name="line-62"></a><span class="lineno">  62 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_x0</span><span class="o">*</span><span class="n">c_x0</span> <span class="o">+</span> <span class="n">f_x1</span><span class="o">*</span><span class="n">c_x1</span><br><a name="line-63"></a><span class="lineno">  63 </span><br><a name="line-64"></a><span class="lineno">  64 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-65"></a><span class="lineno">  65 </span><br><a name="line-66"></a><span class="lineno">  66 </span><br><a name="line-67"></a><span class="lineno">  67 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-68"></a><span class="lineno">  68 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-68">linterp2D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">p_y</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-69"></a><span class="lineno">  69 </span>    <span class="sd">&quot;&quot;&quot;Linearly interpolate two-dimensional arrays at given points.</span><br><a name="line-70"></a><span class="lineno">  70 </span><br><a name="line-71"></a><span class="lineno">  71 </span><span class="sd">    Arguments:</span><br><a name="line-72"></a><span class="lineno">  72 </span><span class="sd">    p_x  -- 1D array:               interpolation points in x</span><br><a name="line-73"></a><span class="lineno">  73 </span><span class="sd">    p_y  -- 1D array of len(px):    interpolation points in y</span><br><a name="line-74"></a><span class="lineno">  74 </span><span class="sd">    o    -- 1D array of len 2:      first point of the grid</span><br><a name="line-75"></a><span class="lineno">  75 </span><span class="sd">    ih   -- 1D array of len 2:      inverse of the grid spacing</span><br><a name="line-76"></a><span class="lineno">  76 </span><span class="sd">    data -- array of shape (N, Nx, Ny): the data to be interpolated</span><br><a name="line-77"></a><span class="lineno">  77 </span><br><a name="line-78"></a><span class="lineno">  78 </span><span class="sd">    Returns:</span><br><a name="line-79"></a><span class="lineno">  79 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-80"></a><span class="lineno">  80 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-81"></a><span class="lineno">  81 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-82"></a><span class="lineno">  82 </span><br><a name="line-83"></a><span class="lineno">  83 </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_y</span><span class="p">)</span><br><a name="line-84"></a><span class="lineno">  84 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-85"></a><span class="lineno">  85 </span><br><a name="line-86"></a><span class="lineno">  86 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-87"></a><span class="lineno">  87 </span><br><a name="line-88"></a><span class="lineno">  88 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><br><a name="line-89"></a><span class="lineno">  89 </span><br><a name="line-90"></a><span class="lineno">  90 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-91"></a><span class="lineno">  91 </span><br><a name="line-92"></a><span class="lineno">  92 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-93"></a><span class="lineno">  93 </span><br><a name="line-94"></a><span class="lineno">  94 </span>        <span class="n">aux_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><br><a name="line-95"></a><span class="lineno">  95 </span>        <span class="n">aux_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><br><a name="line-96"></a><span class="lineno">  96 </span><br><a name="line-97"></a><span class="lineno">  97 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">aux_x</span><span class="p">)</span><br><a name="line-98"></a><span class="lineno">  98 </span>        <span class="n">j</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">aux_y</span><span class="p">)</span><br><a name="line-99"></a><span class="lineno">  99 </span><br><a name="line-100"></a><span class="lineno"> 100 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-101"></a><span class="lineno"> 101 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-102"></a><span class="lineno"> 102 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-103"></a><span class="lineno"> 103 </span>            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-104"></a><span class="lineno"> 104 </span><br><a name="line-105"></a><span class="lineno"> 105 </span>        <span class="n">c_x1</span> <span class="o">=</span> <span class="n">aux_x</span> <span class="o">-</span> <span class="n">i</span><br><a name="line-106"></a><span class="lineno"> 106 </span>        <span class="n">c_x0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c_x1</span><br><a name="line-107"></a><span class="lineno"> 107 </span>        <span class="n">c_y1</span> <span class="o">=</span> <span class="n">aux_y</span> <span class="o">-</span> <span class="n">j</span><br><a name="line-108"></a><span class="lineno"> 108 </span>        <span class="n">c_y0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c_y1</span><br><a name="line-109"></a><span class="lineno"> 109 </span><br><a name="line-110"></a><span class="lineno"> 110 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-111"></a><span class="lineno"> 111 </span><br><a name="line-112"></a><span class="lineno"> 112 </span>            <span class="n">f_x0_y0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><br><a name="line-113"></a><span class="lineno"> 113 </span>            <span class="n">f_x1_y0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><br><a name="line-114"></a><span class="lineno"> 114 </span>            <span class="n">f_x0_y1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-115"></a><span class="lineno"> 115 </span>            <span class="n">f_x1_y1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-116"></a><span class="lineno"> 116 </span><br><a name="line-117"></a><span class="lineno"> 117 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">+</span> <span class="n">f_x0_y0</span><span class="o">*</span><span class="n">c_x0</span><span class="o">*</span><span class="n">c_y0</span> <span class="o">+</span> <span class="n">f_x1_y0</span><span class="o">*</span><span class="n">c_x1</span><span class="o">*</span><span class="n">c_y0</span><br><a name="line-118"></a><span class="lineno"> 118 </span>                            <span class="o">+</span> <span class="n">f_x0_y1</span><span class="o">*</span><span class="n">c_x0</span><span class="o">*</span><span class="n">c_y1</span> <span class="o">+</span> <span class="n">f_x1_y1</span><span class="o">*</span><span class="n">c_x1</span><span class="o">*</span><span class="n">c_y1</span><span class="p">)</span><br><a name="line-119"></a><span class="lineno"> 119 </span><br><a name="line-120"></a><span class="lineno"> 120 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-121"></a><span class="lineno"> 121 </span><br><a name="line-122"></a><span class="lineno"> 122 </span><br><a name="line-123"></a><span class="lineno"> 123 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-124"></a><span class="lineno"> 124 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-124">linterp3D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">p_y</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-125"></a><span class="lineno"> 125 </span>    <span class="sd">&quot;&quot;&quot;Linearly interpolate three-dimensional arrays at given points.</span><br><a name="line-126"></a><span class="lineno"> 126 </span><br><a name="line-127"></a><span class="lineno"> 127 </span><span class="sd">    Arguments:</span><br><a name="line-128"></a><span class="lineno"> 128 </span><span class="sd">    p_x  -- 1D array:               interpolation points in x</span><br><a name="line-129"></a><span class="lineno"> 129 </span><span class="sd">    p_y  -- 1D array of len(px):    interpolation points in y</span><br><a name="line-130"></a><span class="lineno"> 130 </span><span class="sd">    p_z  -- 1D array of len(px):    interpolation points in z</span><br><a name="line-131"></a><span class="lineno"> 131 </span><span class="sd">    o    -- 1D array of len 3:      first point of the grid</span><br><a name="line-132"></a><span class="lineno"> 132 </span><span class="sd">    ih   -- 1D array of len 3:      inverse of the grid spacing</span><br><a name="line-133"></a><span class="lineno"> 133 </span><span class="sd">    data -- array of shape (N, Nx, Ny, Nz): the data to be interpolated</span><br><a name="line-134"></a><span class="lineno"> 134 </span><br><a name="line-135"></a><span class="lineno"> 135 </span><span class="sd">    Returns:</span><br><a name="line-136"></a><span class="lineno"> 136 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-137"></a><span class="lineno"> 137 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-138"></a><span class="lineno"> 138 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-139"></a><span class="lineno"> 139 </span><br><a name="line-140"></a><span class="lineno"> 140 </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_y</span><span class="p">)</span><br><a name="line-141"></a><span class="lineno"> 141 </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_z</span><span class="p">)</span><br><a name="line-142"></a><span class="lineno"> 142 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-143"></a><span class="lineno"> 143 </span><br><a name="line-144"></a><span class="lineno"> 144 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-145"></a><span class="lineno"> 145 </span><br><a name="line-146"></a><span class="lineno"> 146 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><br><a name="line-147"></a><span class="lineno"> 147 </span><br><a name="line-148"></a><span class="lineno"> 148 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-149"></a><span class="lineno"> 149 </span><br><a name="line-150"></a><span class="lineno"> 150 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-151"></a><span class="lineno"> 151 </span><br><a name="line-152"></a><span class="lineno"> 152 </span>        <span class="n">aux_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><br><a name="line-153"></a><span class="lineno"> 153 </span>        <span class="n">aux_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><br><a name="line-154"></a><span class="lineno"> 154 </span>        <span class="n">aux_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_z</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><br><a name="line-155"></a><span class="lineno"> 155 </span><br><a name="line-156"></a><span class="lineno"> 156 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">aux_x</span><span class="p">)</span><br><a name="line-157"></a><span class="lineno"> 157 </span>        <span class="n">j</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">aux_y</span><span class="p">)</span><br><a name="line-158"></a><span class="lineno"> 158 </span>        <span class="n">k</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">aux_z</span><span class="p">)</span><br><a name="line-159"></a><span class="lineno"> 159 </span><br><a name="line-160"></a><span class="lineno"> 160 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-161"></a><span class="lineno"> 161 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-162"></a><span class="lineno"> 162 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-163"></a><span class="lineno"> 163 </span>            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-164"></a><span class="lineno"> 164 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-165"></a><span class="lineno"> 165 </span>            <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-166"></a><span class="lineno"> 166 </span><br><a name="line-167"></a><span class="lineno"> 167 </span>        <span class="n">c_x1</span> <span class="o">=</span> <span class="n">aux_x</span> <span class="o">-</span> <span class="n">i</span><br><a name="line-168"></a><span class="lineno"> 168 </span>        <span class="n">c_x0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c_x1</span><br><a name="line-169"></a><span class="lineno"> 169 </span>        <span class="n">c_y1</span> <span class="o">=</span> <span class="n">aux_y</span> <span class="o">-</span> <span class="n">j</span><br><a name="line-170"></a><span class="lineno"> 170 </span>        <span class="n">c_y0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c_y1</span><br><a name="line-171"></a><span class="lineno"> 171 </span>        <span class="n">c_z1</span> <span class="o">=</span> <span class="n">aux_z</span> <span class="o">-</span> <span class="n">k</span><br><a name="line-172"></a><span class="lineno"> 172 </span>        <span class="n">c_z0</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">c_z1</span><br><a name="line-173"></a><span class="lineno"> 173 </span><br><a name="line-174"></a><span class="lineno"> 174 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-175"></a><span class="lineno"> 175 </span><br><a name="line-176"></a><span class="lineno"> 176 </span>            <span class="n">f_x0_y0_z0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-177"></a><span class="lineno"> 177 </span>            <span class="n">f_x1_y0_z0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-178"></a><span class="lineno"> 178 </span>            <span class="n">f_x0_y1_z0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-179"></a><span class="lineno"> 179 </span>            <span class="n">f_x1_y1_z0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-180"></a><span class="lineno"> 180 </span>            <span class="n">f_x0_y0_z1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-181"></a><span class="lineno"> 181 </span>            <span class="n">f_x1_y0_z1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-182"></a><span class="lineno"> 182 </span>            <span class="n">f_x0_y1_z1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-183"></a><span class="lineno"> 183 </span>            <span class="n">f_x1_y1_z1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-184"></a><span class="lineno"> 184 </span><br><a name="line-185"></a><span class="lineno"> 185 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">+</span> <span class="n">f_x0_y0_z0</span><span class="o">*</span><span class="n">c_x0</span><span class="o">*</span><span class="n">c_y0</span><span class="o">*</span><span class="n">c_z0</span><br><a name="line-186"></a><span class="lineno"> 186 </span>                            <span class="o">+</span> <span class="n">f_x1_y0_z0</span><span class="o">*</span><span class="n">c_x1</span><span class="o">*</span><span class="n">c_y0</span><span class="o">*</span><span class="n">c_z0</span><br><a name="line-187"></a><span class="lineno"> 187 </span>                            <span class="o">+</span> <span class="n">f_x0_y1_z0</span><span class="o">*</span><span class="n">c_x0</span><span class="o">*</span><span class="n">c_y1</span><span class="o">*</span><span class="n">c_z0</span><br><a name="line-188"></a><span class="lineno"> 188 </span>                            <span class="o">+</span> <span class="n">f_x1_y1_z0</span><span class="o">*</span><span class="n">c_x1</span><span class="o">*</span><span class="n">c_y1</span><span class="o">*</span><span class="n">c_z0</span><br><a name="line-189"></a><span class="lineno"> 189 </span>                            <span class="o">+</span> <span class="n">f_x0_y0_z1</span><span class="o">*</span><span class="n">c_x0</span><span class="o">*</span><span class="n">c_y0</span><span class="o">*</span><span class="n">c_z1</span><br><a name="line-190"></a><span class="lineno"> 190 </span>                            <span class="o">+</span> <span class="n">f_x1_y0_z1</span><span class="o">*</span><span class="n">c_x1</span><span class="o">*</span><span class="n">c_y0</span><span class="o">*</span><span class="n">c_z1</span><br><a name="line-191"></a><span class="lineno"> 191 </span>                            <span class="o">+</span> <span class="n">f_x0_y1_z1</span><span class="o">*</span><span class="n">c_x0</span><span class="o">*</span><span class="n">c_y1</span><span class="o">*</span><span class="n">c_z1</span><br><a name="line-192"></a><span class="lineno"> 192 </span>                            <span class="o">+</span> <span class="n">f_x1_y1_z1</span><span class="o">*</span><span class="n">c_x1</span><span class="o">*</span><span class="n">c_y1</span><span class="o">*</span><span class="n">c_z1</span><span class="p">)</span><br><a name="line-193"></a><span class="lineno"> 193 </span><br><a name="line-194"></a><span class="lineno"> 194 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-195"></a><span class="lineno"> 195 </span><br><a name="line-196"></a><span class="lineno"> 196 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Cubic Hermite interpolation one-dimensional arrays at given points. The<br>algorithm implemented in this function is replicated exactly in the following<br>chinterp2D and chinterp3D functions, except in 2 and 3 dimensions<br>respectively.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-201"></a><span class="lineno"> 201 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-202"></a><span class="lineno"> 202 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-202">chinterp1D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-203"></a><span class="lineno"> 203 </span>    <span class="sd">&quot;&quot;&quot;Cubic Hermite interpolation of one-dimensional arrays at given points.</span><br><a name="line-204"></a><span class="lineno"> 204 </span><br><a name="line-205"></a><span class="lineno"> 205 </span><span class="sd">    Arguments:</span><br><a name="line-206"></a><span class="lineno"> 206 </span><span class="sd">    p_x  -- 1D array:               interpolation points in x</span><br><a name="line-207"></a><span class="lineno"> 207 </span><span class="sd">    o    -- scalar:                 first point of the grid</span><br><a name="line-208"></a><span class="lineno"> 208 </span><span class="sd">    ih   -- scalar:                 inverse of the grid spacing</span><br><a name="line-209"></a><span class="lineno"> 209 </span><span class="sd">    data -- array of shape (N, Nx): the data to be interpolated</span><br><a name="line-210"></a><span class="lineno"> 210 </span><br><a name="line-211"></a><span class="lineno"> 211 </span><span class="sd">    Returns:</span><br><a name="line-212"></a><span class="lineno"> 212 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-213"></a><span class="lineno"> 213 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-214"></a><span class="lineno"> 214 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-215"></a><span class="lineno"> 215 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Get the number of interpolation points, the number of input arrays, the<br>shape (in this case, the length) of the input arrays, and allocate the<br>result array.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-219"></a><span class="lineno"> 219 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-220"></a><span class="lineno"> 220 </span><br><a name="line-221"></a><span class="lineno"> 221 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-222"></a><span class="lineno"> 222 </span><br><a name="line-223"></a><span class="lineno"> 223 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><br><a name="line-224"></a><span class="lineno"> 224 </span><br><a name="line-225"></a><span class="lineno"> 225 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-226"></a><span class="lineno"> 226 </span><br><a name="line-227"></a><span class="lineno"> 227 </span>    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ih</span><br><a name="line-228"></a><span class="lineno"> 228 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Loop over the interpolation points. Depending on the application, this<br>loop might be parallelized (if npoints is large enough, e.g. a few<br>hundred) to have better performance.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-232"></a><span class="lineno"> 232 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-233"></a><span class="lineno"> 233 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Compute the index of the point in the array immediately preceding<br>the interpolation point
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-236"></a><span class="lineno"> 236 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">)</span><span class="o">*</span><span class="n">ih</span><span class="p">)</span><br><a name="line-237"></a><span class="lineno"> 237 </span><br><a name="line-238"></a><span class="lineno"> 238 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-239"></a><span class="lineno"> 239 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-240"></a><span class="lineno"> 240 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Compute the displacement of the interpolation point from the point of<br>index i, normalized to the grid spacing (\(s_x\in [0, 1)\))
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-243"></a><span class="lineno"> 243 </span>        <span class="n">s_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><br><a name="line-244"></a><span class="lineno"> 244 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Compute the coefficients. c_x00 is applied to f_x00 (i.e. \(f_0\))<br>and so on.
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-247"></a><span class="lineno"> 247 </span>        <span class="n">c_x00</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-248"></a><span class="lineno"> 248 </span>        <span class="n">c_xp1</span> <span class="o">=</span> <span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-249"></a><span class="lineno"> 249 </span>        <span class="n">c_xm1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-250"></a><span class="lineno"> 250 </span>        <span class="n">c_xp2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-251"></a><span class="lineno"> 251 </span><br></pre></div>

    </td>
</tr>

<tr>
    <td style="vertical-align: top" class="explanation">
        Loop over the input arrays, and interpolate each of them using the<br>coefficients computed above. There is most likely no need to<br>parallelize this loop, because the bumber of input arrays is small<br>in most applications (typically a few tens at most).
    </td>
    <td style="vertical-align: top">
        <div class="highlight"><pre><span></span><a name="line-256"></a><span class="lineno"> 256 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-257"></a><span class="lineno"> 257 </span><br><a name="line-258"></a><span class="lineno"> 258 </span>            <span class="n">f_x00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><br><a name="line-259"></a><span class="lineno"> 259 </span>            <span class="n">f_xp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-260"></a><span class="lineno"> 260 </span>            <span class="n">f_xm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-261"></a><span class="lineno"> 261 </span>            <span class="n">f_xp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-262"></a><span class="lineno"> 262 </span><br><a name="line-263"></a><span class="lineno"> 263 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">+</span> <span class="n">f_x00</span><span class="o">*</span><span class="n">c_x00</span> <span class="o">+</span> <span class="n">f_xp1</span><span class="o">*</span><span class="n">c_xp1</span><br><a name="line-264"></a><span class="lineno"> 264 </span>                            <span class="o">+</span> <span class="n">f_xm1</span><span class="o">*</span><span class="n">c_xm1</span> <span class="o">+</span> <span class="n">f_xp2</span><span class="o">*</span><span class="n">c_xp2</span><span class="p">)</span><br><a name="line-265"></a><span class="lineno"> 265 </span><br><a name="line-266"></a><span class="lineno"> 266 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-267"></a><span class="lineno"> 267 </span><br><a name="line-268"></a><span class="lineno"> 268 </span><br><a name="line-269"></a><span class="lineno"> 269 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-270"></a><span class="lineno"> 270 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-270">chinterp2D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">p_y</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-271"></a><span class="lineno"> 271 </span>    <span class="sd">&quot;&quot;&quot;Cubic Hermite interpolation of two-dimensional arrays at given points.</span><br><a name="line-272"></a><span class="lineno"> 272 </span><br><a name="line-273"></a><span class="lineno"> 273 </span><span class="sd">    Arguments:</span><br><a name="line-274"></a><span class="lineno"> 274 </span><span class="sd">    p_x  -- 1D array:               interpolation points in x</span><br><a name="line-275"></a><span class="lineno"> 275 </span><span class="sd">    p_y  -- 1D array of len(px):    interpolation points in y</span><br><a name="line-276"></a><span class="lineno"> 276 </span><span class="sd">    o    -- 1D array of len 2:      first point of the grid</span><br><a name="line-277"></a><span class="lineno"> 277 </span><span class="sd">    ih   -- 1D array of len 2:      inverse of the grid spacing</span><br><a name="line-278"></a><span class="lineno"> 278 </span><span class="sd">    data -- array of shape (N, Nx, Ny): the data to be interpolated</span><br><a name="line-279"></a><span class="lineno"> 279 </span><br><a name="line-280"></a><span class="lineno"> 280 </span><span class="sd">    Returns:</span><br><a name="line-281"></a><span class="lineno"> 281 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-282"></a><span class="lineno"> 282 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-283"></a><span class="lineno"> 283 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-284"></a><span class="lineno"> 284 </span><br><a name="line-285"></a><span class="lineno"> 285 </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_y</span><span class="p">)</span><br><a name="line-286"></a><span class="lineno"> 286 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-287"></a><span class="lineno"> 287 </span><br><a name="line-288"></a><span class="lineno"> 288 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-289"></a><span class="lineno"> 289 </span><br><a name="line-290"></a><span class="lineno"> 290 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><br><a name="line-291"></a><span class="lineno"> 291 </span><br><a name="line-292"></a><span class="lineno"> 292 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-293"></a><span class="lineno"> 293 </span><br><a name="line-294"></a><span class="lineno"> 294 </span>    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ih</span><br><a name="line-295"></a><span class="lineno"> 295 </span><br><a name="line-296"></a><span class="lineno"> 296 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-297"></a><span class="lineno"> 297 </span><br><a name="line-298"></a><span class="lineno"> 298 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><br><a name="line-299"></a><span class="lineno"> 299 </span>        <span class="n">j</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><br><a name="line-300"></a><span class="lineno"> 300 </span><br><a name="line-301"></a><span class="lineno"> 301 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-302"></a><span class="lineno"> 302 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-303"></a><span class="lineno"> 303 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-304"></a><span class="lineno"> 304 </span>            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-305"></a><span class="lineno"> 305 </span><br><a name="line-306"></a><span class="lineno"> 306 </span>        <span class="n">s_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><br><a name="line-307"></a><span class="lineno"> 307 </span>        <span class="n">s_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">j</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><br><a name="line-308"></a><span class="lineno"> 308 </span><br><a name="line-309"></a><span class="lineno"> 309 </span>        <span class="n">c_x00</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-310"></a><span class="lineno"> 310 </span>        <span class="n">c_xp1</span> <span class="o">=</span> <span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-311"></a><span class="lineno"> 311 </span>        <span class="n">c_xm1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-312"></a><span class="lineno"> 312 </span>        <span class="n">c_xp2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-313"></a><span class="lineno"> 313 </span>        <span class="n">c_y00</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_y</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-314"></a><span class="lineno"> 314 </span>        <span class="n">c_yp1</span> <span class="o">=</span> <span class="n">s_y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-315"></a><span class="lineno"> 315 </span>        <span class="n">c_ym1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-316"></a><span class="lineno"> 316 </span>        <span class="n">c_yp2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_y</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-317"></a><span class="lineno"> 317 </span><br><a name="line-318"></a><span class="lineno"> 318 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-319"></a><span class="lineno"> 319 </span><br><a name="line-320"></a><span class="lineno"> 320 </span>            <span class="n">f_x00_y00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><br><a name="line-321"></a><span class="lineno"> 321 </span>            <span class="n">f_xp1_y00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><br><a name="line-322"></a><span class="lineno"> 322 </span>            <span class="n">f_xm1_y00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><br><a name="line-323"></a><span class="lineno"> 323 </span>            <span class="n">f_xp2_y00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><br><a name="line-324"></a><span class="lineno"> 324 </span>            <span class="n">f_x00_yp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-325"></a><span class="lineno"> 325 </span>            <span class="n">f_xp1_yp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-326"></a><span class="lineno"> 326 </span>            <span class="n">f_xm1_yp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-327"></a><span class="lineno"> 327 </span>            <span class="n">f_xp2_yp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-328"></a><span class="lineno"> 328 </span>            <span class="n">f_x00_ym1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-329"></a><span class="lineno"> 329 </span>            <span class="n">f_xp1_ym1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-330"></a><span class="lineno"> 330 </span>            <span class="n">f_xm1_ym1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-331"></a><span class="lineno"> 331 </span>            <span class="n">f_xp2_ym1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-332"></a><span class="lineno"> 332 </span>            <span class="n">f_x00_yp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-333"></a><span class="lineno"> 333 </span>            <span class="n">f_xp1_yp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-334"></a><span class="lineno"> 334 </span>            <span class="n">f_xm1_yp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-335"></a><span class="lineno"> 335 </span>            <span class="n">f_xp2_yp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-336"></a><span class="lineno"> 336 </span><br><a name="line-337"></a><span class="lineno"> 337 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">+</span> <span class="n">f_x00_y00</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_y00</span> <span class="o">+</span> <span class="n">f_xp1_y00</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_y00</span><br><a name="line-338"></a><span class="lineno"> 338 </span>                            <span class="o">+</span> <span class="n">f_xm1_y00</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_y00</span> <span class="o">+</span> <span class="n">f_xp2_y00</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_y00</span><br><a name="line-339"></a><span class="lineno"> 339 </span>                            <span class="o">+</span> <span class="n">f_x00_yp1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp1</span> <span class="o">+</span> <span class="n">f_xp1_yp1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp1</span><br><a name="line-340"></a><span class="lineno"> 340 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp1</span> <span class="o">+</span> <span class="n">f_xp2_yp1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp1</span><br><a name="line-341"></a><span class="lineno"> 341 </span>                            <span class="o">+</span> <span class="n">f_x00_ym1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_ym1</span> <span class="o">+</span> <span class="n">f_xp1_ym1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_ym1</span><br><a name="line-342"></a><span class="lineno"> 342 </span>                            <span class="o">+</span> <span class="n">f_xm1_ym1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_ym1</span> <span class="o">+</span> <span class="n">f_xp2_ym1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_ym1</span><br><a name="line-343"></a><span class="lineno"> 343 </span>                            <span class="o">+</span> <span class="n">f_x00_yp2</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp2</span> <span class="o">+</span> <span class="n">f_xp1_yp2</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp2</span><br><a name="line-344"></a><span class="lineno"> 344 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp2</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp2</span> <span class="o">+</span> <span class="n">f_xp2_yp2</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp2</span><span class="p">)</span><br><a name="line-345"></a><span class="lineno"> 345 </span><br><a name="line-346"></a><span class="lineno"> 346 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-347"></a><span class="lineno"> 347 </span><br><a name="line-348"></a><span class="lineno"> 348 </span><br><a name="line-349"></a><span class="lineno"> 349 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-350"></a><span class="lineno"> 350 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-350">chinterp3D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">p_y</span><span class="p">,</span> <span class="n">p_z</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-351"></a><span class="lineno"> 351 </span>    <span class="sd">&quot;&quot;&quot;Cubic Hermite interpolation of three-dimensional arrays at given points.</span><br><a name="line-352"></a><span class="lineno"> 352 </span><br><a name="line-353"></a><span class="lineno"> 353 </span><span class="sd">    Arguments:</span><br><a name="line-354"></a><span class="lineno"> 354 </span><span class="sd">    p_x  -- 1D array:               interpolation points in x</span><br><a name="line-355"></a><span class="lineno"> 355 </span><span class="sd">    p_y  -- 1D array of len(px):    interpolation points in y</span><br><a name="line-356"></a><span class="lineno"> 356 </span><span class="sd">    p_z  -- 1D array of len(px):    interpolation points in z</span><br><a name="line-357"></a><span class="lineno"> 357 </span><span class="sd">    o    -- 1D array of len 2:      first point of the grid</span><br><a name="line-358"></a><span class="lineno"> 358 </span><span class="sd">    ih   -- 1D array of len 2:      inverse of the grid spacing</span><br><a name="line-359"></a><span class="lineno"> 359 </span><span class="sd">    data -- array of shape (N, Nx, Ny, Nz): the data to be interpolated</span><br><a name="line-360"></a><span class="lineno"> 360 </span><br><a name="line-361"></a><span class="lineno"> 361 </span><span class="sd">    Returns:</span><br><a name="line-362"></a><span class="lineno"> 362 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-363"></a><span class="lineno"> 363 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-364"></a><span class="lineno"> 364 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-365"></a><span class="lineno"> 365 </span><br><a name="line-366"></a><span class="lineno"> 366 </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_y</span><span class="p">)</span><br><a name="line-367"></a><span class="lineno"> 367 </span>    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_z</span><span class="p">)</span><br><a name="line-368"></a><span class="lineno"> 368 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-369"></a><span class="lineno"> 369 </span><br><a name="line-370"></a><span class="lineno"> 370 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-371"></a><span class="lineno"> 371 </span><br><a name="line-372"></a><span class="lineno"> 372 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><br><a name="line-373"></a><span class="lineno"> 373 </span><br><a name="line-374"></a><span class="lineno"> 374 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-375"></a><span class="lineno"> 375 </span><br><a name="line-376"></a><span class="lineno"> 376 </span>    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ih</span><br><a name="line-377"></a><span class="lineno"> 377 </span><br><a name="line-378"></a><span class="lineno"> 378 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-379"></a><span class="lineno"> 379 </span><br><a name="line-380"></a><span class="lineno"> 380 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><br><a name="line-381"></a><span class="lineno"> 381 </span>        <span class="n">j</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><br><a name="line-382"></a><span class="lineno"> 382 </span>        <span class="n">k</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_z</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><br><a name="line-383"></a><span class="lineno"> 383 </span><br><a name="line-384"></a><span class="lineno"> 384 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-385"></a><span class="lineno"> 385 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-386"></a><span class="lineno"> 386 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-387"></a><span class="lineno"> 387 </span>            <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-388"></a><span class="lineno"> 388 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-389"></a><span class="lineno"> 389 </span>            <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-390"></a><span class="lineno"> 390 </span><br><a name="line-391"></a><span class="lineno"> 391 </span>        <span class="n">s_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><br><a name="line-392"></a><span class="lineno"> 392 </span>        <span class="n">s_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">j</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><br><a name="line-393"></a><span class="lineno"> 393 </span>        <span class="n">s_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_z</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><br><a name="line-394"></a><span class="lineno"> 394 </span><br><a name="line-395"></a><span class="lineno"> 395 </span>        <span class="n">c_x00</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-396"></a><span class="lineno"> 396 </span>        <span class="n">c_xp1</span> <span class="o">=</span> <span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-397"></a><span class="lineno"> 397 </span>        <span class="n">c_xm1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-398"></a><span class="lineno"> 398 </span>        <span class="n">c_xp2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_x</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-399"></a><span class="lineno"> 399 </span>        <span class="n">c_y00</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_y</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_y</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-400"></a><span class="lineno"> 400 </span>        <span class="n">c_yp1</span> <span class="o">=</span> <span class="n">s_y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-401"></a><span class="lineno"> 401 </span>        <span class="n">c_ym1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-402"></a><span class="lineno"> 402 </span>        <span class="n">c_yp2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_y</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_y</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-403"></a><span class="lineno"> 403 </span>        <span class="n">c_z00</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_z</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_z</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_z</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-404"></a><span class="lineno"> 404 </span>        <span class="n">c_zp1</span> <span class="o">=</span> <span class="n">s_z</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s_z</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_z</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-405"></a><span class="lineno"> 405 </span>        <span class="n">c_zm1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">s_z</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-406"></a><span class="lineno"> 406 </span>        <span class="n">c_zp2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">s_z</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s_z</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-407"></a><span class="lineno"> 407 </span><br><a name="line-408"></a><span class="lineno"> 408 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-409"></a><span class="lineno"> 409 </span><br><a name="line-410"></a><span class="lineno"> 410 </span>            <span class="n">f_x00_y00_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-411"></a><span class="lineno"> 411 </span>            <span class="n">f_xp1_y00_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-412"></a><span class="lineno"> 412 </span>            <span class="n">f_xm1_y00_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-413"></a><span class="lineno"> 413 </span>            <span class="n">f_xp2_y00_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-414"></a><span class="lineno"> 414 </span>            <span class="n">f_x00_yp1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-415"></a><span class="lineno"> 415 </span>            <span class="n">f_xp1_yp1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-416"></a><span class="lineno"> 416 </span>            <span class="n">f_xm1_yp1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-417"></a><span class="lineno"> 417 </span>            <span class="n">f_xp2_yp1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-418"></a><span class="lineno"> 418 </span>            <span class="n">f_x00_ym1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-419"></a><span class="lineno"> 419 </span>            <span class="n">f_xp1_ym1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-420"></a><span class="lineno"> 420 </span>            <span class="n">f_xm1_ym1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-421"></a><span class="lineno"> 421 </span>            <span class="n">f_xp2_ym1_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-422"></a><span class="lineno"> 422 </span>            <span class="n">f_x00_yp2_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-423"></a><span class="lineno"> 423 </span>            <span class="n">f_xp1_yp2_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-424"></a><span class="lineno"> 424 </span>            <span class="n">f_xm1_yp2_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-425"></a><span class="lineno"> 425 </span>            <span class="n">f_xp2_yp2_z00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><br><a name="line-426"></a><span class="lineno"> 426 </span>            <span class="n">f_x00_y00_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-427"></a><span class="lineno"> 427 </span>            <span class="n">f_xp1_y00_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-428"></a><span class="lineno"> 428 </span>            <span class="n">f_xm1_y00_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-429"></a><span class="lineno"> 429 </span>            <span class="n">f_xp2_y00_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-430"></a><span class="lineno"> 430 </span>            <span class="n">f_x00_yp1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-431"></a><span class="lineno"> 431 </span>            <span class="n">f_xp1_yp1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-432"></a><span class="lineno"> 432 </span>            <span class="n">f_xm1_yp1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-433"></a><span class="lineno"> 433 </span>            <span class="n">f_xp2_yp1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-434"></a><span class="lineno"> 434 </span>            <span class="n">f_x00_ym1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-435"></a><span class="lineno"> 435 </span>            <span class="n">f_xp1_ym1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-436"></a><span class="lineno"> 436 </span>            <span class="n">f_xm1_ym1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-437"></a><span class="lineno"> 437 </span>            <span class="n">f_xp2_ym1_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-438"></a><span class="lineno"> 438 </span>            <span class="n">f_x00_yp2_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-439"></a><span class="lineno"> 439 </span>            <span class="n">f_xp1_yp2_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-440"></a><span class="lineno"> 440 </span>            <span class="n">f_xm1_yp2_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-441"></a><span class="lineno"> 441 </span>            <span class="n">f_xp2_yp2_zp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-442"></a><span class="lineno"> 442 </span>            <span class="n">f_x00_y00_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-443"></a><span class="lineno"> 443 </span>            <span class="n">f_xp1_y00_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-444"></a><span class="lineno"> 444 </span>            <span class="n">f_xm1_y00_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-445"></a><span class="lineno"> 445 </span>            <span class="n">f_xp2_y00_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-446"></a><span class="lineno"> 446 </span>            <span class="n">f_x00_yp1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-447"></a><span class="lineno"> 447 </span>            <span class="n">f_xp1_yp1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-448"></a><span class="lineno"> 448 </span>            <span class="n">f_xm1_yp1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-449"></a><span class="lineno"> 449 </span>            <span class="n">f_xp2_yp1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-450"></a><span class="lineno"> 450 </span>            <span class="n">f_x00_ym1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-451"></a><span class="lineno"> 451 </span>            <span class="n">f_xp1_ym1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-452"></a><span class="lineno"> 452 </span>            <span class="n">f_xm1_ym1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-453"></a><span class="lineno"> 453 </span>            <span class="n">f_xp2_ym1_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-454"></a><span class="lineno"> 454 </span>            <span class="n">f_x00_yp2_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-455"></a><span class="lineno"> 455 </span>            <span class="n">f_xp1_yp2_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-456"></a><span class="lineno"> 456 </span>            <span class="n">f_xm1_yp2_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-457"></a><span class="lineno"> 457 </span>            <span class="n">f_xp2_yp2_zm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-458"></a><span class="lineno"> 458 </span>            <span class="n">f_x00_y00_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-459"></a><span class="lineno"> 459 </span>            <span class="n">f_xp1_y00_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-460"></a><span class="lineno"> 460 </span>            <span class="n">f_xm1_y00_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-461"></a><span class="lineno"> 461 </span>            <span class="n">f_xp2_y00_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-462"></a><span class="lineno"> 462 </span>            <span class="n">f_x00_yp1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-463"></a><span class="lineno"> 463 </span>            <span class="n">f_xp1_yp1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-464"></a><span class="lineno"> 464 </span>            <span class="n">f_xm1_yp1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-465"></a><span class="lineno"> 465 </span>            <span class="n">f_xp2_yp1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-466"></a><span class="lineno"> 466 </span>            <span class="n">f_x00_ym1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-467"></a><span class="lineno"> 467 </span>            <span class="n">f_xp1_ym1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-468"></a><span class="lineno"> 468 </span>            <span class="n">f_xm1_ym1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-469"></a><span class="lineno"> 469 </span>            <span class="n">f_xp2_ym1_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-470"></a><span class="lineno"> 470 </span>            <span class="n">f_x00_yp2_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-471"></a><span class="lineno"> 471 </span>            <span class="n">f_xp1_yp2_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-472"></a><span class="lineno"> 472 </span>            <span class="n">f_xm1_yp2_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-473"></a><span class="lineno"> 473 </span>            <span class="n">f_xp2_yp2_zp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-474"></a><span class="lineno"> 474 </span><br><a name="line-475"></a><span class="lineno"> 475 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">+</span> <span class="n">f_x00_y00_z00</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-476"></a><span class="lineno"> 476 </span>                            <span class="o">+</span> <span class="n">f_xp1_y00_z00</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-477"></a><span class="lineno"> 477 </span>                            <span class="o">+</span> <span class="n">f_xm1_y00_z00</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-478"></a><span class="lineno"> 478 </span>                            <span class="o">+</span> <span class="n">f_xp2_y00_z00</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-479"></a><span class="lineno"> 479 </span>                            <span class="o">+</span> <span class="n">f_x00_yp1_z00</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-480"></a><span class="lineno"> 480 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp1_z00</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-481"></a><span class="lineno"> 481 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp1_z00</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-482"></a><span class="lineno"> 482 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp1_z00</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-483"></a><span class="lineno"> 483 </span>                            <span class="o">+</span> <span class="n">f_x00_ym1_z00</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-484"></a><span class="lineno"> 484 </span>                            <span class="o">+</span> <span class="n">f_xp1_ym1_z00</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-485"></a><span class="lineno"> 485 </span>                            <span class="o">+</span> <span class="n">f_xm1_ym1_z00</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-486"></a><span class="lineno"> 486 </span>                            <span class="o">+</span> <span class="n">f_xp2_ym1_z00</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-487"></a><span class="lineno"> 487 </span>                            <span class="o">+</span> <span class="n">f_x00_yp2_z00</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-488"></a><span class="lineno"> 488 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp2_z00</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-489"></a><span class="lineno"> 489 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp2_z00</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-490"></a><span class="lineno"> 490 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp2_z00</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_z00</span><br><a name="line-491"></a><span class="lineno"> 491 </span>                            <span class="o">+</span> <span class="n">f_x00_y00_zp1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-492"></a><span class="lineno"> 492 </span>                            <span class="o">+</span> <span class="n">f_xp1_y00_zp1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-493"></a><span class="lineno"> 493 </span>                            <span class="o">+</span> <span class="n">f_xm1_y00_zp1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-494"></a><span class="lineno"> 494 </span>                            <span class="o">+</span> <span class="n">f_xp2_y00_zp1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-495"></a><span class="lineno"> 495 </span>                            <span class="o">+</span> <span class="n">f_x00_yp1_zp1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-496"></a><span class="lineno"> 496 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp1_zp1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-497"></a><span class="lineno"> 497 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp1_zp1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-498"></a><span class="lineno"> 498 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp1_zp1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-499"></a><span class="lineno"> 499 </span>                            <span class="o">+</span> <span class="n">f_x00_ym1_zp1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-500"></a><span class="lineno"> 500 </span>                            <span class="o">+</span> <span class="n">f_xp1_ym1_zp1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-501"></a><span class="lineno"> 501 </span>                            <span class="o">+</span> <span class="n">f_xm1_ym1_zp1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-502"></a><span class="lineno"> 502 </span>                            <span class="o">+</span> <span class="n">f_xp2_ym1_zp1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-503"></a><span class="lineno"> 503 </span>                            <span class="o">+</span> <span class="n">f_x00_yp2_zp1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-504"></a><span class="lineno"> 504 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp2_zp1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-505"></a><span class="lineno"> 505 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp2_zp1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-506"></a><span class="lineno"> 506 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp2_zp1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp1</span><br><a name="line-507"></a><span class="lineno"> 507 </span>                            <span class="o">+</span> <span class="n">f_x00_y00_zm1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-508"></a><span class="lineno"> 508 </span>                            <span class="o">+</span> <span class="n">f_xp1_y00_zm1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-509"></a><span class="lineno"> 509 </span>                            <span class="o">+</span> <span class="n">f_xm1_y00_zm1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-510"></a><span class="lineno"> 510 </span>                            <span class="o">+</span> <span class="n">f_xp2_y00_zm1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-511"></a><span class="lineno"> 511 </span>                            <span class="o">+</span> <span class="n">f_x00_yp1_zm1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-512"></a><span class="lineno"> 512 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp1_zm1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-513"></a><span class="lineno"> 513 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp1_zm1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-514"></a><span class="lineno"> 514 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp1_zm1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-515"></a><span class="lineno"> 515 </span>                            <span class="o">+</span> <span class="n">f_x00_ym1_zm1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-516"></a><span class="lineno"> 516 </span>                            <span class="o">+</span> <span class="n">f_xp1_ym1_zm1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-517"></a><span class="lineno"> 517 </span>                            <span class="o">+</span> <span class="n">f_xm1_ym1_zm1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-518"></a><span class="lineno"> 518 </span>                            <span class="o">+</span> <span class="n">f_xp2_ym1_zm1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-519"></a><span class="lineno"> 519 </span>                            <span class="o">+</span> <span class="n">f_x00_yp2_zm1</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-520"></a><span class="lineno"> 520 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp2_zm1</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-521"></a><span class="lineno"> 521 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp2_zm1</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-522"></a><span class="lineno"> 522 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp2_zm1</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zm1</span><br><a name="line-523"></a><span class="lineno"> 523 </span>                            <span class="o">+</span> <span class="n">f_x00_y00_zp2</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-524"></a><span class="lineno"> 524 </span>                            <span class="o">+</span> <span class="n">f_xp1_y00_zp2</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-525"></a><span class="lineno"> 525 </span>                            <span class="o">+</span> <span class="n">f_xm1_y00_zp2</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-526"></a><span class="lineno"> 526 </span>                            <span class="o">+</span> <span class="n">f_xp2_y00_zp2</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_y00</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-527"></a><span class="lineno"> 527 </span>                            <span class="o">+</span> <span class="n">f_x00_yp1_zp2</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-528"></a><span class="lineno"> 528 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp1_zp2</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-529"></a><span class="lineno"> 529 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp1_zp2</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-530"></a><span class="lineno"> 530 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp1_zp2</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-531"></a><span class="lineno"> 531 </span>                            <span class="o">+</span> <span class="n">f_x00_ym1_zp2</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-532"></a><span class="lineno"> 532 </span>                            <span class="o">+</span> <span class="n">f_xp1_ym1_zp2</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-533"></a><span class="lineno"> 533 </span>                            <span class="o">+</span> <span class="n">f_xm1_ym1_zp2</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-534"></a><span class="lineno"> 534 </span>                            <span class="o">+</span> <span class="n">f_xp2_ym1_zp2</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_ym1</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-535"></a><span class="lineno"> 535 </span>                            <span class="o">+</span> <span class="n">f_x00_yp2_zp2</span><span class="o">*</span><span class="n">c_x00</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-536"></a><span class="lineno"> 536 </span>                            <span class="o">+</span> <span class="n">f_xp1_yp2_zp2</span><span class="o">*</span><span class="n">c_xp1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-537"></a><span class="lineno"> 537 </span>                            <span class="o">+</span> <span class="n">f_xm1_yp2_zp2</span><span class="o">*</span><span class="n">c_xm1</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp2</span><br><a name="line-538"></a><span class="lineno"> 538 </span>                            <span class="o">+</span> <span class="n">f_xp2_yp2_zp2</span><span class="o">*</span><span class="n">c_xp2</span><span class="o">*</span><span class="n">c_yp2</span><span class="o">*</span><span class="n">c_zp2</span><span class="p">)</span><br><a name="line-539"></a><span class="lineno"> 539 </span><br><a name="line-540"></a><span class="lineno"> 540 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-541"></a><span class="lineno"> 541 </span><br><a name="line-542"></a><span class="lineno"> 542 </span><br><a name="line-543"></a><span class="lineno"> 543 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-544"></a><span class="lineno"> 544 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-544">spchinterp_kernel</a></span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f_m1</span><span class="p">,</span> <span class="n">f_00</span><span class="p">,</span> <span class="n">f_p1</span><span class="p">,</span> <span class="n">f_p2</span><span class="p">):</span><br><a name="line-545"></a><span class="lineno"> 545 </span><br><a name="line-546"></a><span class="lineno"> 546 </span>    <span class="n">c_0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-547"></a><span class="lineno"> 547 </span>    <span class="n">c_1</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><br><a name="line-548"></a><span class="lineno"> 548 </span>    <span class="n">c_d0</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><br><a name="line-549"></a><span class="lineno"> 549 </span>    <span class="n">c_d1</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><br><a name="line-550"></a><span class="lineno"> 550 </span><br><a name="line-551"></a><span class="lineno"> 551 </span>    <span class="k">if</span> <span class="p">(</span><span class="n">f_00</span> <span class="o">-</span> <span class="n">f_m1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">f_p1</span> <span class="o">-</span> <span class="n">f_00</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span><br><a name="line-552"></a><span class="lineno"> 552 </span>        <span class="n">d_0</span> <span class="o">=</span> <span class="mf">0.</span><br><a name="line-553"></a><span class="lineno"> 553 </span>    <span class="k">else</span><span class="p">:</span><br><a name="line-554"></a><span class="lineno"> 554 </span>        <span class="n">d_0</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">f_00</span> <span class="o">-</span> <span class="n">f_m1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">f_p1</span> <span class="o">-</span> <span class="n">f_00</span><span class="p">))</span><br><a name="line-555"></a><span class="lineno"> 555 </span><br><a name="line-556"></a><span class="lineno"> 556 </span>    <span class="k">if</span> <span class="p">(</span><span class="n">f_p1</span> <span class="o">-</span> <span class="n">f_00</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">f_p2</span> <span class="o">-</span> <span class="n">f_p1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span><br><a name="line-557"></a><span class="lineno"> 557 </span>        <span class="n">d_1</span> <span class="o">=</span> <span class="mf">0.</span><br><a name="line-558"></a><span class="lineno"> 558 </span>    <span class="k">else</span><span class="p">:</span><br><a name="line-559"></a><span class="lineno"> 559 </span>        <span class="n">d_1</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">f_p1</span> <span class="o">-</span> <span class="n">f_00</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">f_p2</span> <span class="o">-</span> <span class="n">f_p1</span><span class="p">))</span><br><a name="line-560"></a><span class="lineno"> 560 </span><br><a name="line-561"></a><span class="lineno"> 561 </span>    <span class="k">return</span> <span class="n">f_00</span><span class="o">*</span><span class="n">c_0</span> <span class="o">+</span> <span class="n">f_p1</span><span class="o">*</span><span class="n">c_1</span> <span class="o">+</span> <span class="n">d_0</span><span class="o">*</span><span class="n">c_d0</span> <span class="o">+</span> <span class="n">d_1</span><span class="o">*</span><span class="n">c_d1</span><br><a name="line-562"></a><span class="lineno"> 562 </span><br><a name="line-563"></a><span class="lineno"> 563 </span><br><a name="line-564"></a><span class="lineno"> 564 </span><span class="nd">@njit</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fastmath</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><br><a name="line-565"></a><span class="lineno"> 565 </span><span class="k">def</span> <span class="nf"><a href="uniform_interpolation.py.html#line-565">spchinterp1D</a></span><span class="p">(</span><span class="n">p_x</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span><br><a name="line-566"></a><span class="lineno"> 566 </span>    <span class="sd">&quot;&quot;&quot;Shape-preserving cubic Hermite interpolation of one-dimensional arrays</span><br><a name="line-567"></a><span class="lineno"> 567 </span><span class="sd">    at given points.</span><br><a name="line-568"></a><span class="lineno"> 568 </span><br><a name="line-569"></a><span class="lineno"> 569 </span><span class="sd">    Arguments:</span><br><a name="line-570"></a><span class="lineno"> 570 </span><span class="sd">    p_x  -- 1D array:               interpolation points in x</span><br><a name="line-571"></a><span class="lineno"> 571 </span><span class="sd">    o    -- scalar:                 first point of the grid</span><br><a name="line-572"></a><span class="lineno"> 572 </span><span class="sd">    ih   -- scalar:                 inverse of the grid spacing</span><br><a name="line-573"></a><span class="lineno"> 573 </span><span class="sd">    data -- array of shape (N, Nx): the data to be interpolated</span><br><a name="line-574"></a><span class="lineno"> 574 </span><br><a name="line-575"></a><span class="lineno"> 575 </span><span class="sd">    Returns:</span><br><a name="line-576"></a><span class="lineno"> 576 </span><span class="sd">    result -- array of shape (N, len(px)): the result of</span><br><a name="line-577"></a><span class="lineno"> 577 </span><span class="sd">              the interpolation for each data array at each point</span><br><a name="line-578"></a><span class="lineno"> 578 </span><span class="sd">    &quot;&quot;&quot;</span><br><a name="line-579"></a><span class="lineno"> 579 </span><br><a name="line-580"></a><span class="lineno"> 580 </span>    <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span><br><a name="line-581"></a><span class="lineno"> 581 </span><br><a name="line-582"></a><span class="lineno"> 582 </span>    <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br><a name="line-583"></a><span class="lineno"> 583 </span><br><a name="line-584"></a><span class="lineno"> 584 </span>    <span class="n">shape</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><br><a name="line-585"></a><span class="lineno"> 585 </span><br><a name="line-586"></a><span class="lineno"> 586 </span>    <span class="n">result</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ndata</span><span class="p">,</span> <span class="n">npoints</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><br><a name="line-587"></a><span class="lineno"> 587 </span><br><a name="line-588"></a><span class="lineno"> 588 </span>    <span class="n">h</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">ih</span><br><a name="line-589"></a><span class="lineno"> 589 </span><br><a name="line-590"></a><span class="lineno"> 590 </span>    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span><br><a name="line-591"></a><span class="lineno"> 591 </span><br><a name="line-592"></a><span class="lineno"> 592 </span>        <span class="n">i</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-1">np</a></span><span class="o">.</span><span class="n">int64</span><span class="p">((</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="n">o</span><span class="p">)</span><span class="o">*</span><span class="n">ih</span><span class="p">)</span><br><a name="line-593"></a><span class="lineno"> 593 </span><br><a name="line-594"></a><span class="lineno"> 594 </span>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">shape</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span><br><a name="line-595"></a><span class="lineno"> 595 </span>            <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span><br><a name="line-596"></a><span class="lineno"> 596 </span><br><a name="line-597"></a><span class="lineno"> 597 </span>        <span class="n">s_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">o</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">ih</span><br><a name="line-598"></a><span class="lineno"> 598 </span><br><a name="line-599"></a><span class="lineno"> 599 </span>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span><br><a name="line-600"></a><span class="lineno"> 600 </span><br><a name="line-601"></a><span class="lineno"> 601 </span>            <span class="n">f_x00</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><br><a name="line-602"></a><span class="lineno"> 602 </span>            <span class="n">f_xp1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-603"></a><span class="lineno"> 603 </span>            <span class="n">f_xm1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><br><a name="line-604"></a><span class="lineno"> 604 </span>            <span class="n">f_xp2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><br><a name="line-605"></a><span class="lineno"> 605 </span><br><a name="line-606"></a><span class="lineno"> 606 </span>            <span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n"><a href="uniform_interpolation.py.html#line-544">spchinterp_kernel</a></span><span class="p">(</span><span class="n">s_x</span><span class="p">,</span> <span class="n">f_xm1</span><span class="p">,</span> <span class="n">f_x00</span><span class="p">,</span> <span class="n">f_xp1</span><span class="p">,</span> <span class="n">f_xp2</span><span class="p">)</span><br><a name="line-607"></a><span class="lineno"> 607 </span><br><a name="line-608"></a><span class="lineno"> 608 </span>    <span class="k">return</span> <span class="n">result</span><br><a name="line-609"></a><span class="lineno"> 609 </span><br><a name="line-610"></a><span class="lineno"> 610 </span><br></pre></div>

    </td>
</tr>

        </table>

    </body>

</html>
